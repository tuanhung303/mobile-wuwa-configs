; ==========================================================================================
;       WuWa Mobile Config - Ultimate Edition v4.7 (Elite Optimized)
;       Target: 120 FPS via Hardware Frame Generation | Max Quality | Warm Colors
;       Device: Snapdragon Elite Gen 5 / 16GB RAM (Adreno 840)
;       v4.7 Changes: Adreno 840 "Elite" Oracle-Validated Enhancements:
;                     - GPU Skinning: Moved vertex math to compute pipeline (r.Mobile.EnableGPUSkinning=1)
;                     - SkinCache: Mode 1 enabled with 128MB safety limit for Character/Hair fidelity
;                     - Async Logic: Global enablement (r.AsyncCompute=1) for better G-Buffer overlap
;                     - Memory: Reserved 2048 Descriptor Sets to stabilize heavy skill bursts
;       v4.6 Changes: Adreno 840 "Elite" Final Optimizations:
;                     - Hardware Frame Gen: High-fidelity AFME Level 5 enabled
;                     - Vulkan 1.3: Bindless Descriptor Indexing + FP16 Math
;                     - Aesthetics: 16x Anisotropy + Mobile SSS + Contact Shadows
;                     - Stability: Expanded PSO Cache (512MB) + Descriptor Pool (16k)
;                     - Core Affinity: RHI/FG threads moved to Performance cores (4-5)
;       v4.5 Changes: Adreno 840 "Elite" Optimizations:
;                     - GTAO: Full-resolution pass (optimized for 18MB HPM cache)
;                     - SSR: Quality 4 + MaxRoughness 0.8 expansion
;                     - Vulkan: EDS2, VertexInputDynamicState, ShaderSubgroupExtendedTypes
;                     - Cache: 384MB Pipeline Cache + 32 LRU Capacity
;                     - Hardware: Tier 2 VRS, Queue Priority, and HPM Pinning
;       v4.4 Changes: Performance micro-optimizations (Oracle-validated):
;                     - Memory: FreeSkeletalMeshBuffers, ReleasePreviousLODInfo
;                     - CPU: SkipRedundantTransformUpdate
;                     - GPU Culling: CullBeforeFetch, CullInstances, DownsampledOcclusionQueries
;                     - Adreno 830: AsyncComputeQueue, SubmitAfterEverySubpass=0
;                     - Shadow: UnusedTriangleCulling, SubPrimitiveQueries
;       v4.3 Changes: CPU/GPU throughput optimizations (Oracle-validated):
;                     - Draw call batching (MobileBasePassDrawcallLimit=24000)
;                     - Shadow batch optimization (ShadowPerBatchDrawcallMax=6)
;                     - Simplified deferred shading for GMEM optimization
;                     - Aggressive PVS culling for reduced CPU occlusion cost
;                     - Increased VFX batch size (32->64) for better core utilization
;                     - Vulkan Pipeline LRU Cache for reduced shader stutters
;                     - Fixed CSM distances for stable shadow rendering
;       v4.2 Changes: Performance optimizations without aesthetic impact:
;                     - Enabled VRS (Variable Rate Shading) for 10-15% GPU savings
;                     - Tiered CSM PCF quality (5/4/3/2) for distant shadows
;                     - Disabled redundant SSGI (Kuro GI handles this)
;                     - Disabled DF/HeightField shadows (too heavy for mobile)
;                     - Half-res GTAO (imperceptible at mobile PPI)
;                     - Reduced SSR to Quality 3 (FSR3 hides noise)
;                     - Increased texture pool to 4GB for 16GB RAM
;                     - Removed dead TAA fallback code
;       v4.1 Changes: Oracle-validated optimizations for Snapdragon 8 Elite:
;                     - Reduced Physics Workers to 4 (prevents core contention)
;                     - Exclusive FSR3 AA (disabled redundant TAA stack)
;                     - Disabled RobustBufferAccess (reclaimed 3-5% GPU performance)
;                     - Reduced MaxFrameLatency to 1 (reduced input lag)
;                     - CAUTION: Experimental RHI Thread Pacing (test for stability)
; ==========================================================================================

[SystemSettings]
r.Mobile.EnableGPUSkinning=1
r.GPUSkinning.SupportComputeSkinning=1
r.SkinCache.Mode=1
r.SkinCache.CompileShaders=1
r.SkinCache.SceneMemoryLimitInMB=128
r.SkinCache.RecomputeTangents=1

; --- Async Logic ---
r.AsyncCompute=1
r.RHICmdUseAsyncCompute=1

; --- Scale Logic (v3.6 Centralized) ---
r.MobileContentScaleFactor=0 ; Native device resolution (0 = device native)
r.SecondaryScreenPercentage.GameViewport=100 ; Ensures 1:1 pixel rendering (Native resolution)

r.FEstimation.Option=1 ; [v4.6] ENABLED: Native hardware frame generation (AFME) for 120 FPS stability

; --- Stability & Blueprint Logic ---
Blueprint.EnableFrameScripts=1 ; Required for game logic consistency
Blueprint.EnableEvents=1 
Blueprint.EnableEventsBudget=0 ; Disable budget to prevent script hitching on high-end CPUs
Blueprint.EnableFrameScriptsBudget=0
Blueprint.EnablePhysicsBudget=0
Blueprint.EnableVehicles=1
Kuro.Blueprint.EnableGameBudget=0 ; Ensures game logic doesn't skip frames during intense combat
Kuro.Blueprint.EnablePhysics=1
Kuro.Blueprint.EnablePhysicsBudget=0

; --- Chaos Physics Simulation (v3.5) ---
p.Chaos.Simulation.Enable=1
p.Chaos.DedicatedThreadEnabled=1
p.Chaos.GC.UseReplicationV2=true
p.Chaos.Solver.Collision.AllowManifoldUpdate=1
p.Chaos.DebugDraw.Enabled=false
p.Chaos.Solver.Collision.CullDistance=-1
p.Chaos.NewtonEvolution.FastPositionBasedFriction=true
p.Chaos.Solver.InertiaConditioning.Enabled=true
p.Chaos.MaxNumWorkers=4
p.Chaos.SmallBatchSize=10
p.Chaos.LargeBatchSize=100

; --- Physics ISPC Vectorization (v4.0 - Missing from test.ini) ---
p.AggregateGeom.ISPC=1
p.Chaos.AABBTransform.ISPC=1
p.Chaos.AxialSpring.ISPC=1
p.Chaos.Bending.ISPC=1
p.Chaos.BoxCalcBounds.ISPC=1
p.Chaos.CalculateBounds.ISPC=1
p.Chaos.CollisionSpring.ISPC=1
p.Chaos.DampVelocity.ISPC=1
p.Chaos.GetSimData.ISPC=1
p.Chaos.LongRange.ISPC=1
p.Chaos.MultiRes.ISPC=1
p.Chaos.PerParticleCollision.ISPC=1
p.Chaos.PostIterationUpdates.ISPC=1
p.Chaos.PreSubstepInterpolation.ISPC=1
p.Chaos.SkinPhysicsMesh.ISPC=1
p.Chaos.SoftBodyCollision.ISPC=1
p.Chaos.Spherical.ISPC=1
p.Chaos.Spring.ISPC=1
p.Chaos.TriangleMesh.ISPC=1
p.Chaos.VelocityField.ISPC=1
p.Chaos.XPBDBending.ISPC=1
p.Chaos.XPBDSpring.ISPC=1
p.Chaos.XPBDStretchBias.ISPC=1

; Legacy Apex (minimal)
apex.DbgDraw=false
apex.ChunkFractureEnabled=false
apex.ForceMinimalFracture=true

; --- [v4.3] Draw Call Optimization (Oracle-validated) ---
r.MeshDrawCommands.MobileBasePassDrawcallLimit=24000  ; Prevents mid-frame buffer reallocs
r.MeshDrawCommands.ShadowPerBatchDrawcallMax=6        ; Shadow draw call batching

; --- Anti-Flicker Safeguard (v3.1) ---
; Prevents black/white flickering boxes on some Adreno GPUs
; 0 = Hardware occlusion queries (stable), 1 = HZB system, 2 = Force HZB
r.HZBOcclusion=0

; --- Frame Rate Control & Pacing (v4.0 EXPERIMENTAL) ---
t.MaxFPS=120
t.MinFPS=45
FrameRateLimit=120.0
r.VSync=0
a.UseSwappyForFramePacing=0
; [v4.0 CAUTION] Experimental RHI Pacing - may improve smoothness or cause crashes
r.Vulkan.CPURHIThreadFramePacer=0 ; [v4.6] DISABLED: Conflicts with AFME hardware frame generation
; --- Lighting Fixes (The "Yellow/Over-Exposed" Fix) ---
r.DefaultFeature.Bloom=1 ; Required for skill VFX
r.BloomQuality=1 ; High quality bloom filter
r.Bloom.Intensity=0.02 ; [DO NOT TOUCH] Reverted to stable sweet spot to prevent blinding skill effects
r.Bloom.Threshold=5.0 ; [DO NOT TOUCH] High threshold prevents haze
r.Bloom.SizeScale=0.005 ; [DO NOT TOUCH] Keeps bloom crisp
r.Mobile.HDR=1 ; Enables high dynamic range for better color depth
r.Mobile.DeferredShadingSimple=1 ; [v4.3] Optimizes G-Buffer packing for Adreno GMEM
r.HDR.EnableHDROutput=1 ; Allows the display to utilize full peak brightness
r.Atmosphere.RayleighScatteringScale=1.0 ; [DO NOT TOUCH] Fixes yellow/orange sky tint
r.Atmosphere.MieScatteringScale=0.8 ; [DO NOT TOUCH] Fixes sun-haze over-exposure
r.Atmosphere.SunLightIntensity=1.0 ; Standard sun intensity to prevent blowout
r.Color.Mid=0.5 ; Ensures neutral midtones
r.SupportAtmosphericFog=0 ; DISABLED: Fog disabled for visual clarity
r.Fog=0
r.VolumetricFog=0

; --- Post-Process Cleanup ---
r.MotionBlurQuality=0 ; DISABLED: Removes blur during fast camera movement
r.SceneColorFringeQuality=0 ; DISABLED: Removes Chromatic Aberration (color bleeding on edges)
r.ChromaticAberrationQuality=0
r.FilmGrain=0 ; DISABLED: Removes noise for a cleaner image

; --- Anti-Aliasing & Upscaling (FSR3 Exclusive) ---
r.DefaultFeature.AntiAliasing=0 ; DISABLED: Handled exclusively by FSR3
r.AntiAliasingMethod=0 ; DISABLED: Handled exclusively by FSR3
; [v4.2] TAA fallback settings removed - dead code when FSR3 active
r.FidelityFX.FSR.Enabled=True ; Enables AMD FSR for better edge reconstruction
r.FidelityFX.FSR.QualityMode=1 ; Balanced quality for 90 FPS stability

; --- FSR2 Temporal Upscaling (v3.7 - From Ultra_lite) ---
; Enhanced temporal upscaling with better motion handling
r.FidelityFX.FSR2.Enabled=1                  ; Enable FSR2 temporal upscaler
r.FidelityFX.FSR2.QualityMode=1              ; Quality mode (1=Quality, 2=Balanced, 3=Performance)
r.FidelityFX.FSR2.Sharpness=1.0              ; Maximum sharpness for crisp output
r.FidelityFX.FSR2.AdjustMipBias=1            ; Adjust texture mip bias for FSR2
r.FidelityFX.FSR2.CreateReactiveMask=1       ; Create reactive mask for better edge handling
r.FidelityFX.FSR2.DeDither=2                 ; Dithering removal level

; --- FSR3 Frame Generation (v3.9 - From Low Config via Oracle) ---
; Note: FSR3 takes priority over FSR2 when both are enabled
r.FidelityFX.FSR3.Enabled=1                  ; Enable FSR3 (overrides FSR2)
r.FidelityFX.FSR3.QualityMode=1              ; Quality mode for upscaling
r.FidelityFX.FSR3.FI=1                       ; Frame Interpolation (doubles perceived FPS)
r.FidelityFX.FSR3.AdjustMipBias=1            ; Texture mip bias adjustment
r.FidelityFX.FI.Enabled=1                    ; Enable Frame Interpolation module

; --- [EXPERIMENTAL v3.1] GPU-Accelerated TAA ---
; Offloads TAA computation to GPU compute pipeline - may improve performance on 8 Elite
; To revert: Comment out or set to 0
r.TemporalAA.MobileUseCompute=1
r.TemporalAA.MobileCatmullRom=1 ; Higher quality interpolation filter

; --- [EXPERIMENTAL v3.1] Velocity Rendering ---
; Improves TAA motion detection for cleaner edges during fast movement
; To revert: Comment out all three lines below
r.Mobile.EnableOutlineVelocity=1
r.Mobile.RenderVelocity=1
r.BasePassOutputsVelocity=1

; --- Mesh LOD Bias ---
r.SkeletalMeshLODBias=-2 ; Global mesh LOD bias (higher detail at distance)
r.StaticMeshLODBias=-2

; --- Decal System (v3.5) ---
r.Decal.MaxActive=80 ; [v4.2] Reduced from 128 - prevents GPU stall during skill spam
r.Decal.FadeScreenSize=0.01
r.Decal.NormalProjectionEnabled=1
r.Decal.FadeDurationScale=3.0
r.Decal.FadeScreenSizeMult=0.80
r.Decal.NormalReprojectionThresholdHigh=0.995
r.Decal.NormalReprojectionThresholdLow=0.99
r.Decal.StencilSizeThreshold=0.1
r.Decal.Visibility.Multithreaded=1
r.DecalDepthBias=0.005

; --- Screen Space Effects (SSR & GI) ---
r.SSR.Quality=4 ; [v4.5] Increased for Adreno 840 headroom
r.SSR.MaxRoughness=0.8 ; [v4.5] Expanded reflection range for 8 Elite
r.SSR.Temporal=1 ; Reduces noise/jitter in reflections
r.Anisotropy=16 ; [v4.6] PC-class texture sharpness
r.MaxAnisotropy=16
r.Mobile.SubsurfaceScattering=1 ; [v4.6] Character skin light bleed
r.SSS.SampleCount=4
r.ContactShadows=1 ; [v4.6] Improved grounding shadows
r.ContactShadows.NonShadowCastingIntensity=0 ; Prevents toon skin artifacts
r.SSGI.Enable=0 ; [v4.2] DISABLED: Kuro GI handles this; UE4 SSGI causes halos
; r.SSGI.Quality=1 ; [v4.2] Commented - no effect when SSGI disabled
r.SSGI.HalfRes=1 ; Optimizes GI rendering for high-end mobile
r.ReflectionCaptureResolution=128 ; High resolution cubemaps for characters

; --- Niagara & VFX ---
fx.Niagara.QualityLevel=2 ; Cinematic VFX (Level 1 is too "flat")
fx.NiagaraKuroTickUpdateTime=0.1 ; Balances VFX smoothness vs CPU overhead
r.Niagara.EmitterViewDistanceScale=5.0 ; Prevents skills from disappearing too early in distance
r.ParticleLightQuality=1 ; Particles cast light on the environment

; --- GPU Particle Compute (v3.5) ---
r.Niagara.AllowGPUParticles=1
r.Niagara.AsyncGpuTickEnabled=1
r.Niagara.GPUCompute=1
r.Niagara.GPUParticle.SimulateOnGPU=1

; --- Niagara GPU Optimizations (v3.9 - From Low Config via Oracle) ---
Niagara.GPUCulling.CPUToGPUThreshold=768     ; [v4.5] Lower threshold to offload more to Adreno 840
Niagara.GPUSorting.CPUToGPUThreshold=3072    ; Threshold for GPU sorting
Niagara.Ribbon.GpuEnabled=1                  ; GPU ribbon rendering
Niagara.Ribbon.Tessellation.Enabled=1        ; Ribbon tessellation
Niagara.Ribbon.Tessellation.MaxInterp=8      ; Max interpolation steps
Niagara.MinGPUInstanceCount=1024             ; [v4.5] Optimized for 8 Elite wide warp
Niagara.MinCulledGPUInstanceCount=1024       ; [v4.5] Optimized for 8 Elite wide warp

; --- FX Async Threading (v3.5) ---
FX.AllowAsyncTick=1
FX.BatchAsync=1
FX.BatchAsyncBatchSize=64 ; [v4.3] Increased from 32 for better core utilization
FX.EarlyScheduleAsync=1

; --- Kuro Enhanced Character Features (v4.6 - Elite Optimized) ---
r.Kuro.HairQuality=2 ; High-quality hair rendering with proper strand shading
r.Kuro.AFME.Enable=5 ; [v4.6] High-fidelity hardware frame interpolation mode
r.Kuro.ClothSimulate=1 ; Enable cloth physics simulation for realistic movement
r.Kuro.CharacterClothQuality=2 ; High cloth detail and tessellation
r.Kuro.CharacterShadowQuality=3 ; [RESTORED] Enhanced self-shadows on characters
r.Kuro.MobileHairLODBias=0 ; No LOD reduction for hair (full quality at distance)
r.Kuro.MobileClothLODBias=0 ; No LOD reduction for cloth physics
r.KuroMobile.FacialAnimationQuality=2 ; High facial animation quality for cutscenes
r.KuroMobile.SkinCacheQuality=2 ; High skin rendering cache for smooth character rendering
r.Kuro.EnableCharacterLut=1 ; Character-specific color lookup table for better skin tones
r.KuroMobile.LensFlareQuality=3 ; High-quality lens flare effects
Kuro.InteractiveLeavesForceMobilePreview=1 ; Interactive foliage reacts to character movement
r.Kuro.EnableCharacterSSS=1 ; [v4.6] Restore character light diffusion

; --- Kuro Clean Visual Enhancements (v3.4) ---
r.Kuro.EnablePlanarReflection=1 ; Crisp planar reflections on water/floors
r.Kuro.GlobalLightQuality=4 ; Maximum lighting quality for clean shadows
r.Kuro.ToonOutlineDrawDistanceMobile=2000 ; Character outline visible at distance
r.Kuro.ToonEyeTransparentDrawDistanceMobile=800 ; Eye transparency/sparkle at distance
r.Kuro.ToonFaceShadowMeshDrawDistanceMobile=800 ; [RESTORED] Face shadow detail at distance
r.Mobile.CustomDepthForToonRim=1 ; Clean toon rim lighting on characters
r.Mobile.TreeRimLight=1 ; Crisp rim lighting on trees/foliage
r.Mobile.EnableKuroSpotlightsShadow=1 ; [RESTORED] Sharp spotlight shadows
r.Shadow.KuroEnablePointLightShadow=1 ; [RESTORED] Sharp point light shadows

; --- Kuro Extended Visual Features (v3.5) ---
r.Kuro.GlobalGIRenderQuality=3              ; High GI render quality
r.Kuro.GlobalGIResDiv=1                      ; [v3.6] Full resolution GI
r.Kuro.EnableAtmosphereLightDirection=1     ; Atmosphere light direction
r.Kuro.KuroBloomStreak=1                    ; Bloom streak effects
r.KuroCSCloth.Enable=1                      ; Compute shader cloth physics
r.KuroTonemapping=1                         ; Kuro tonemapping pipeline
r.Kuro.InteractionEffect.UseCppWaterEffect=1 ; C++ water interaction effects
r.Kuro.EffectQuality=3                       ; [v3.6] High-fidelity particles

; --- Kuro Landscape (v3.5) ---
r.CapsuleKuroAO=1                           ; Capsule ambient occlusion

; --- Water Rendering ---
r.Mobile.WaterQuality=1 ; Enables high-quality water shaders
r.Mobile.WaterSSR=1 ; Enables Screen Space Reflections on water

; --- Water Reflection Enhancements (v3.5) ---
r.Mobile.EnableWaterReflection=1
r.Mobile.WaterSSRResDiv=1.0
r.Mobile.WaterSSRStep=64
r.Water.WaterMesh.EnableRendering=1
r.Water.ShallowWaterRenderTargetSize=1024

; --- Threading & Vulkan ---
r.Vulkan.Enable=1 ; Best API for Snapdragon 8 Elite
r.Vulkan.NumWorkerThreads=6 ; Utilizing 6 Performance cores for parallelism
r.Vulkan.EnableRayQuery=0 ; CRITICAL: Ray Query is experimental and causes instant crashes
r.Vulkan.MaxFrameLatency=1 ; [v4.1] Reduced for lower input lag on 8 Elite
r.Vulkan.EnableBindlessRendering=1 ; [DO NOT TOUCH] Critical performance boost for 8 Elite
r.ShaderPipelineCache.Enabled=1 ; Reduces shader compilation stutters
r.ShaderPipelineCache.ReportFrameTick=1
t.MaxWorkerThreads=6 ; Syncs with Vulkan threads for stability
r.Shaders.FastMath=1 ; Uses faster math operations for Adreno GPUs
r.Shaders.Optimize=1

; --- Vulkan Parallel Rendering (v3.5) ---
r.Vulkan.UseAsyncCompute=1
r.Vulkan.UseFramePacing=1
r.Vulkan.UseFastPipelineCreation=1
r.Vulkan.EnableParallelRendering=1
r.Vulkan.UsePreemption=1
r.Vulkan.PipelineCacheSizeMB=512             ; [v4.6] Optimized PSO cache for 8 Elite
r.Vulkan.EnablePipelineLRUCache=1            ; [v4.3] Reduces shader compile stutters
r.Vulkan.PipelineLRUCapacityMaximum=64        ; [v4.6] Expanded for 16GB RAM overhead
r.Vulkan.PipelineCacheFromShaderPipelineCache=1 ; [v4.3] Links pipeline cache to shader cache
r.Mobile.EnableShaderCache=1                 ; [v3.6] Reduces initial region stutters
r.Vulkan.EnableDescriptorIndexing=1          ; [v4.6] Bindless descriptor indexing for Adreno 840

; --- Vulkan 1.3 Backend Enhancements (v3.9 - From Low Config via Oracle) ---
r.Vulkan.DescriptorSetReserve=2048
r.Vulkan.ThreadedCommandBufferRecording=1    ; Multi-threaded command buffer recording
r.Vulkan.Synchronization2=1                  ; Vulkan 1.3 sync primitives
r.Vulkan.EnableDynamicRendering=1            ; Dynamic rendering (no render passes)
r.Vulkan.EnableExtendedDynamicState=1        ; Extended dynamic state for reduced PSO switches
r.Vulkan.EnableExtendedDynamicState2=1       ; [v4.5] EDS2 for reduced PSO switches on 8 Elite
r.Vulkan.EnableVertexInputDynamicState=1     ; [v4.5] Vertex input dynamic state for reduced PSO switches
r.Vulkan.EnableShaderSubgroupExtendedTypes=1 ; [v4.5] Enables 16-bit math in wave ops for Adreno 840
r.Vulkan.EnablePushDescriptor=1              ; Push descriptors for faster binding

; --- [v4.0 CAUTION] Vulkan Stability Safety ---
r.Vulkan.DescriptorSetReserve=2048           ; [v4.6] Doubled for complex Elite-level VFX
r.Vulkan.MaxDescriptorSets=16384              ; [v4.6] Prevents "Device Lost" during intense bursts
r.Vulkan.RobustBufferAccess=0              ; [v4.1] Disabled to reclaim 3-5% GPU performance

; --- [v4.2] Variable Rate Shading (Adreno 830 Tier 2 VRS) ---
r.VRS.Enable=1                               ; 10-15% GPU savings in complex scenes
r.Vulkan.AllowVRS=1                          ; [v4.5] Enables hardware-level VRS on Adreno 840
r.Vulkan.EnableQueuePriority=1               ; [v4.5] Prioritizes render queue over streaming on 840
r.Mobile.ForceDepthResolved=0                ; [v4.5] Keeps depth in HPM cache longer

; --- Shadow Optimization (v3.8) ---
r.Shadow.MaxResolution=2048
r.Shadow.MaxCSMResolution=2048
r.Shadow.CSM.MaxCascades=3
r.Shadow.CSM.TransitionScale=0.8
r.Shadow.FilterMethod=1
; [v4.2] Tiered PCF quality - distant cascades don't need max filtering
r.Shadow.CSM0ShadowPCFQuality=5  ; Near shadows - keep max
r.Shadow.CSM1ShadowPCFQuality=4
r.Shadow.CSM2ShadowPCFQuality=3
r.Shadow.CSM3ShadowPCFQuality=2  ; Far shadows - reduced
r.Shadow.PerObjShadowPCFQuality=4
r.CapsuleShadows=1
r.DistanceFieldShadowing=0 ; [v4.2] DISABLED: DF shadows cause leaking on mobile; CSM handles shadows
r.HeightFieldShadowing=0   ; [v4.2] DISABLED: Too heavy for 120 FPS target
; r.HFShadowQuality=3      ; [v4.2] Commented - no effect when HeightFieldShadowing disabled
r.Shadow.WholeSceneShadows=1
r.Shadow.CacheWPOPrimitives=1
r.Shadow.CSM3Distance=8000
r.Shadow.CSM4Distance=8000
r.Shadow.DistanceScale=1.0

; --- [v4.3] Fixed CSM Distances (Oracle-validated) ---
; Eliminates shadow "shimmering" during camera movement
r.Shadow.CSMEnableFixedDistance=1
r.Shadow.CSM0Distance=700                    ; Near cascade
r.Shadow.CSM1Distance=1700                   ; Mid cascade
r.Shadow.CSM2Distance=8000                   ; Far cascade

; --- Shadow Performance Stabilization (v3.8) ---
r.Shadow.CSMCaching=1
r.Shadow.CacheWholeSceneShadows=1
r.Shadow.WholeSceneShadowCacheMb=300
r.ParallelPrepareDynamicShadows=1
r.ParallelInitDynamicShadows=1
r.Mobile.ParallelShadows=1
r.Shadow.CSMScrollingOverlapAreaThrottle=0.75
r.Shadow.MaxNumPointShadowCacheUpdatesPerFrame=2
r.Shadow.MaxNumSpotShadowCacheUpdatesPerFrame=2

; --- Visibility & Culling Optimizations (v3.7 - From Ultra_lite) ---
; Parallel visibility calculations for faster scene culling
r.EnableAggressivePVS=1                              ; [v4.3] Aggressive precomputed visibility culling
r.EnableWPLevelPVS=1                         ; World Partition level PVS
r.EnableNavPartition=1                       ; Navigation partitioning
r.Visibility.DynamicMeshElements.NumMainViewTasks=16   ; [v4.2] Reduced from 21 - prevents scheduler thrashing
r.Visibility.DynamicMeshElements.NumShadowViewTasks=16 ; [v4.2] Reduced from 21
r.Visibility.DynamicMeshElements.Parallel=1  ; Parallel dynamic mesh processing
r.Visibility.FrustumCull.Enabled=1           ; Frustum culling enabled
r.Visibility.FrustumCull.NumPrimitivesPerTask=0
r.Visibility.FrustumCull.UseFastIntersect=1  ; Fast intersection tests
r.Visibility.FrustumCull.UseOctree=0         ; Disabled for mobile performance
r.Visibility.FrustumCull.UseSphereTestFirst=1
r.Visibility.OcclusionCull.MaxQueriesPerTask=0
r.Visibility.Relevance.NumPrimitivesPerPacket=0
r.Visibility.SkipAlwaysVisible=1             ; Skip always-visible checks
r.Visibility.TaskSchedule=1                  ; Task-based scheduling

; --- [v4.4] Performance Micro-Optimizations (Oracle-Validated) ---
; Memory Optimization
r.FreeSkeletalMeshBuffers=1                              ; 300-500MB RAM savings
r.SkinnedMesh.ReleasePreviousLODInfoOnInitialization=1   ; LOD memory cleanup

; CPU Optimization
r.SkipRedundantTransformUpdate=1                         ; Skip unchanged transform updates

; GPU Culling
r.DownsampledOcclusionQueries=1                          ; Cheaper occlusion queries
r.CullBeforeFetch=1                                      ; Cull before GPU vertex fetch
r.CullInstances=1                                        ; Aggressive instance culling

; Adreno 830 TBDR Optimization
r.Vulkan.AsyncComputeQueue=1                             ; Leverage async compute
r.Vulkan.SubmitAfterEverySubpass=0                       ; Better TBDR tile batching

; Advanced Shadow Culling
r.Shadow.UnusedTriangleCulling=1                         ; Cull triangles outside shadow view
r.AllowSubPrimitiveQueries=1                             ; Granular occlusion

; --- RHI Command Threading (v3.7 - From Ultra_lite) ---
; Enables multi-threaded RHI command processing for better CPU utilization
r.RHICmdUseThread=1                          ; Use dedicated RHI thread
r.RHICmdUseThreadGroup=1                     ; Thread group for RHI commands
r.RHICmdAsyncRHIThreadDispatch=1             ; Async dispatch to RHI thread
r.RHICmdBypass=1                             ; Bypass for single-threaded fallback
r.RHICmdUseAsyncCompute=1                    ; Async compute queue usage
r.RHICmdMergeSmallDeferredContexts=1         ; Merge small deferred contexts
r.RHICmdTranslucencyPassDeferredContexts=1   ; Deferred translucency pass
r.RHICmdUseDeferredContexts=1                ; Use deferred command contexts
r.RHICmdUseParallelAlgorithms=1              ; Parallel command algorithms
r.RHICmdVelocityPassDeferredContexts=1       ; Deferred velocity pass

; --- Enhanced Garbage Collection (v3.1) ---
; Multi-threaded, incremental GC for smoother frame times during long sessions
gc.IncrementalReachabilityTimeLimit=0.005 ; Prevents 1ms GC hitches during combat
gc.TimeBetweenPurgingPendingKillObjects=60.0 ; Faster cleanup of deleted objects to save RAM
gc.AllowIncrementalReachability=1 ; Spreads reachability work across frames
gc.AllowIncrementalGather=1 ; Spreads gather work across frames
gc.IncrementalGCTimePerFrame=0.001 ; Limit GC time per frame
gc.AllowParallelGC=1 ; Multi-core GC reduces hitching
gc.ContinuousIncrementalGC=1 ; Spreads GC work continuously
gc.MultithreadedDestructionEnabled=1 ; Faster object cleanup on multiple cores
gc.ActorClusteringEnabled=1 ; Groups related actors for efficient cleanup
gc.AssetClusteringEnabled=1 ; Groups related assets for efficient cleanup
gc.BlueprintClusteringEnabled=1 ; Groups blueprint objects for efficient cleanup
gc.CreateGCClusters=1 ; Enable GC clustering system
gc.MinGCClusterSize=5 ; Minimum cluster size for efficiency
gc.PendingKillEnabled=1 ; Standard pending kill behavior
gc.NumRetriesBeforeForcingGC=10 ; Retries before forcing full GC
gc.MaxObjectsNotConsideredByGC=200 ; Small objects threshold
gc.SizeOfPermanentObjectPool=2097152 ; 2MB permanent object pool

; --- [v4.0] Core GC Settings (From test.ini) ---
gc.GarbageEliminationEnabled=1
gc.IncrementalBeginDestroyEnabled=1
gc.MaxObjectsInGame=25165824                  ; [CAUTION] Massive pool for 16GB RAM
gc.AdditionalFinishDestroyTimeGC=30

[/Script/Engine.RendererSettings]
r.EarlyZPass=3 ; Optimizes depth rendering
r.EarlyZPassMovable=1
r.Mobile.HDR=1
r.MaterialQualityLevel=1 ; Forces High material shaders
r.DetailMode=2 ; Enables all high-detail decorative objects
r.Tonemapper.Quality=5 ; [v3.5] Highest stable tonemapper logic
r.Tonemapper.Sharpen=0.8 ; [DO NOT TOUCH] Reverted to 0.8 for optimal mobile PPI balance
r.EyeAdaptation.PreExposureOverride=0.9 ; [DO NOT TOUCH] Compensation to prevent blowout
r.AmbientOcclusionLevels=3 ; Enhances contact shadows in corners/foliage
r.AmbientOcclusionMaxQuality=100 ; Ensures crisp contact shadows

; --- GTAO Ambient Occlusion (v3.9 - From Low Config via Oracle) ---
; GTAO provides higher quality AO than standard SSAO
r.GTAO.Combined=1                            ; Combined GTAO pass
r.GTAO.SpatialFilter=1                       ; Spatial filtering for smoother AO
r.GTAO.TemporalFilter=1                      ; Temporal filtering for stability
r.GTAO.UseNormals=1                          ; Use normals for better accuracy
r.GTAO.Downsample=0                          ; [v4.5] Full-res GTAO - Optimized for Adreno 840 HPM cache
r.GTAO.ThicknessBlend=0.5                    ; Thickness blending factor
r.GTAO.FalloffEnd=200                        ; AO falloff distance
r.GTAO.NumAngles=2                           ; Sample angles
r.LightShafts=1 ; Enables god rays for cinematic atmosphere
r.LightShaftQuality=1
r.Mobile.SceneColorFormat=3 ; [DO NOT TOUCH] Float16 for better gradients (8 Elite stable)

; --- Animation Update Rate Optimization (v3.5) ---
a.URO.Enable=1
a.URO.DisableInterpolation=0
bEnableUpdateRateOptimizations=True
bEnableAnimUpdateRateOptimizations=True
bOptimizeBoneTransforms=True

; --- Animation ISPC Vectorization (v3.9 - From Low Config via Oracle) ---
; ISPC compiler optimizations for multi-core animation processing
a.BlendCurves.ISPC=1                         ; Vectorized curve blending
a.BlendPoseAccumulate.ISPC=1                 ; Vectorized pose accumulation
a.BlendPoseOverwrite.ISPC=1                  ; Vectorized pose overwrite
a.ConstantKeyLerp.ISPC=1                     ; Vectorized constant key lerp
a.LerpBoneTransforms.ISPC=1                  ; Vectorized bone transform lerp
a.SkeletalMesh.ISPC=1                        ; Vectorized skeletal mesh processing
a.SkinnedAsset.ISPC=1                        ; Vectorized skinned asset processing
a.VariableKeyLerp.ISPC=1                     ; Vectorized variable key lerp
a.ParallelAnimInterpolation=1                ; Parallel animation interpolation
a.ParallelAnimUpdate=1                       ; Parallel animation update
a.ParallelBlendPhysics=1                     ; Parallel blend physics

; --- [v4.0] Additional Anim ISPC (From test.ini) ---
a.AccumulateLocalSpaceAdditivePose.ISPC=1
a.BonePose.ISPC=1
a.ConvertMeshRotationPoseToLocalSpace.ISPC=1
a.ConvertPoseToAdditive.ISPC=1
a.ConvertPoseToMeshRotation.ISPC=1
a.PerTrackCompression.ISPC=1
a.BlendPosesPerBoneFilter.ISPC=1

; --- Mobile Quality Flags (v3.5) ---
r.Mobile.UseHWsRGBEncoding=1
r.Mobile.UseClusteredDeferredShading=1
r.Mobile.SupportsGen4TAA=1
r.Mobile.HighQualitySkyCaptureFiltering=1
r.Mobile.UseHalfResDepth32=1

; --- Mesh Distance Fields (v3.5) ---
r.GenerateMeshDistanceFields=1
TaskGraph.EnableForkedMultithreading=1

; --- Color Balance (Warm Color Enhancement - v3.3 Refined) ---
r.TonemapperFilm=1 ; Filmic tonemapper - preserves warm highlights (orange/red/pink)
r.TonemapperGamma=2.2 ; Standard sRGB gamma curve
r.Color.Gain.R=1.03 ; [v3.5] Red boost (+3%)
r.Color.Gain.G=0.95 ; [v3.3] Adjusted green (-5% from neutral, +1% from v3.2)
r.Color.Gain.B=1.0 ; Standard blue (neutral)

; ==========================================================================================
;       STREAMING SETTINGS (v4.0 Enhanced)
; ==========================================================================================
[/Script/Engine.StreamingSettings]
r.TextureStreaming=1
r.Streaming.Boost=1.25 ; Moderate boost to prioritize visible textures
r.Streaming.FullyLoadUsedTextures=0 ; Stream textures instead of forcing full load
r.Streaming.UseAsyncRequestsForDDC=1 ; Async requests prevent stalls
r.Streaming.UseBackgroundThreadPool=1 ; Background thread pool for streaming
r.Streaming.MinBoost=1.0 ; Keep min boost reasonable
r.Streaming.PoolSize=4096 ; [v4.2] 4GB streaming pool for 16GB RAM devices
r.Streaming.MaxBandwidth=100000              ; [v3.6] Optimized for UFS 4.0 throughput
r.Streaming.AmortizeCPUUsage=1               ; [v3.6] Smoother texture loading
r.Streaming.UseFixedPoolSize=1 ; Fixed pool size for stability
r.Streaming.UseMaterialData=1 ; Optimize streaming decisions with material data
r.Streaming.UseNewMetrics=1 ; Better quality/performance balance
r.Streaming.UsePerTextureBias=1 ; Per-texture biasing for memory optimization
s.AsyncLoadingThreadEnabled=1
s.EventDrivenLoaderEnabled=1 ; Async streaming
s.WarnIfTimeLimitExceeded=0 ; Disable warnings for cleaner logs
s.UseBackgroundLevelStreaming=1 ; Eliminates stalls
s.LevelStreamingActorsUpdateTimeLimit=5.0 ; Limit update time per frame
s.PriorityLevelStreamingActorsUpdateExtraTime=5.0
s.LevelStreamingComponentsRegistrationGranularity=5
s.UnregisterComponentsTimeLimit=1.0 ; Lower to eliminate long unregister spikes
s.LevelStreamingComponentsUnregistrationGranularity=2
s.FlushStreamingOnExit=1
s.AsyncLoadingTimeLimit=2.0 ; Reduce async loading time budget for smoothness

; --- Streaming Optimizations (v3.5 - Eggsie) ---
r.Streaming.GroupBoost.CommonHLODTextureFactor=0.6
r.Streaming.GroupBoost.HugeBuildingTextureFactor=0.6
r.Streaming.GroupBoost.HugeFoliageTextureFactor=0.6
r.Streaming.GroupBoost.HugeNpcTextureFactor=0.6
r.Streaming.GroupBoost.LandscapeHLODTextureFactor=0.6
r.Streaming.GroupBoost.LargeBuildingTextureFactor=0.6
r.Streaming.GroupBoost.LargeFoliageTextureFactor=0.6
r.Streaming.GroupBoost.LargeNpcTextureFactor=0.6
r.Streaming.PoolSizeForMeshes=1000
r.RenderTargetPoolMin=400

; --- Extended IO Dispatcher (v4.0 Enhanced) ---
s.IoDispatcherBufferAlignment=6144
s.IoDispatcherBufferMemoryMB=384
s.IoDispatcherBufferSizeKB=384
s.IoDispatcherCacheSizeMB=1536
s.IoDispatcherRequestLatencyCircuitBreakerMS=0
s.IoDispatcherSortRequestsByOffset=1
s.IoDispatcherTocsEnablePerfectHashing=1
s.StorageServerIoDispatcherBatchSize=16
s.StorageServerIoDispatcherMaxActiveBatchCount=4
s.StreamableDelegateDelayFrames=1
s.TimeLimitExceededMultiplier=4.5

; --- Enhanced IO & Streaming (v3.9) ---
s.LargeMemoryDataMaxPoolLength=4             ; Increased pool for 16GB RAM
s.MaxIncomingRequestsToStall=100             ; Higher stall threshold for UFS 4.0
s.MaxPrecacheRequestsInFlight=4              ; More concurrent precache requests
s.OptimizeActorRegistration=1                ; Optimized actor registration
s.PriorityAsyncLoadingExtraTime=75           ; Extra time for priority loading
s.OnlyProcessRequiredPackagesWhenSyncLoading=1 ; Reduce sync load overhead
s.LevelStreamingLowMemoryPendingPurgeCount=2147483647 ; [v4.0] Aggressive purging to save RAM
r.Streaming.AllowParallelRenderAssetStreamingManagerIncrementalUpdate=1
r.Streaming.EnableTexturesSamplingStreamingCache=1
r.Streaming.MaxEffectiveScreenSize=2160      ; 4K streaming target
r.Streaming.FramesForFullUpdate=1            ; Faster streaming updates

; --- Virtual Textures (v3.5) ---
r.VirtualTextures=1
r.VirtualTexturedLightmaps=1
r.VT.AnisotropicFiltering=16
r.VT.MaxAnisotropy=16
r.VT.PoolSize=2048
r.VT.TileSize=512

; ==========================================================================================
;       SHADER PRECOMPILATION (v3.1) - Reduces First-Time Stuttering
; ==========================================================================================
[DevOptions.Shaders]
bAllowPrecompiledShaders=True
bCompilePreloadShaders=True
bForcePrecompiledShaders=True
bPrecompileVisibleShadersForRendering=True
bPreloadAllShaders=True
bPreloadShaderCacheOnDemand=True
bPreloadShadersOnDemand=True
bUsePrecompiledShaders=True
bWaitForShaderCompilation=True

; ==========================================================================================
;       ANDROID RUNTIME SETTINGS (v3.1)
; ==========================================================================================
[/Script/AndroidRuntimeSettings.AndroidRuntimeSettings]
a.UseSwappyForFramePacing=0 ; DISABLED: Native frame gen handles pacing internally
bEnableDynamicMaxFPS=True ; [v3.1] ENABLED: Allows native frame gen to dynamically adjust FPS
bSupportsVulkanSM5=True
r.VSync=0
rhi.SyncInterval=0

; ==========================================================================================
;       CONSOLE VARIABLES (v3.1)
; ==========================================================================================
[ConsoleVariables]
t.MaxWorkerThreads=6
log.LogSuppressed=1 ; Suppress log spam

; --- PSO Precaching (v3.7 - From Ultra_lite) ---
; Reduces shader compilation stutters by precompiling pipeline state objects
r.pso.CreateOnRHIThread=1                    ; Create PSOs on RHI thread
r.pso.evictiontime=20                        ; PSO cache eviction time (seconds)
r.pso.PrecompileThreadPoolPercentOfHardwareThreads=80 ; Use 80% of threads for precompile
r.PSOPrecache.Components=1                   ; Precache component PSOs
r.PSOPrecache.GlobalComputeShaders=1         ; Precache compute shaders
r.PSOPrecaching=1                            ; Enable PSO precaching system
shaderpipeline.MinPrecompileTasksInFlight=6  ; Minimum concurrent precompile tasks

; ==========================================================================================
;       LOG SUPPRESSION (v3.1) - Reduces Disk I/O
; ==========================================================================================
[Core.Log]
Global=off
LogTemp=off
LogOnline=off
LogAudio=off
LogInit=off
LogRender=off
LogStreaming=off
LogMemory=off
LogPakFile=off
LogNet=off
LogNetPackageMap=off
LogAndroid=off
LogVulkan=off
LogShaderCompilers=off
LogPSO=off
LogRHI=off
LogEditorAnalytics=off
LogHMD=off
LogConfig=off
LogStats=off
LogHLOD=off
LogGarbage=off
LogTexture=off
LogMaterial=off
LogLightRendering=off
LogRenderer=off
LogOcclusion=off
LogNavMesh=off
LogLoad=off
LogAssetRegistry=off
